function [ im_out ] = toy_reconstruct( im_in )

    [imh, imw, nn] = size(im_in);
    Im2var = zeros(imh, imw);
    Im2var(1:imh*imw) = 1: imh*imw;

    M = 2 * imh * imw + 1;
    N = imh * imw;
    
    A = sparse([], [], [], M, N);
    b = zeros(M, 1);

    e = 1;
    for y = 1:imh
        for x = 1:imw-1
            A(e, Im2var(y,x+1)) = 1;
            A(e, Im2var(y,x)) = -1;
            b(e) = im_in(y,x+1)-im_in(y,x);  
            e = e+1;
        end  
    end    

    for y = 1:imh-1
        for x = 1:imw
            A(e, Im2var(y+1,x)) = 1;
            A(e, Im2var(y,x)) = -1;
            b(e) = im_in(y+1,x)-im_in(y,x);  
            e = e+1;
        end  
    end    

    A(e, Im2var(1,1)) = 1;
    b(e) = im_in(1,1);

    v = A\b;
    im_out = reshape(v, [imh, imw]);
    imwrite(im_out, 'results/toy_recon.png');

    
end

